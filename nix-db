#!/usr/bin/bash
[ -s /usr/bin/frawk ] && alias awk=frawk
[ -s /usr/bin/grep ] && alias grep=rg
DATA_DIR=$HOME/.local/bin/nix-db/db
getFiles(){ find "$DATA_DIR" -type f;}
files=($(getFiles))
vars=($(for file in "${files[@]}"; do head -n1 "$file"; done))
whereVar(){ i=1
	for var in "${vars[@]}"; do
		[ "$var" = "$1" ] && echo "$i" && return
		i=$((i=i+1))
	done;}
loopFile(){ for file in "${files[@]}"; do
		"$@" "$file" &
	done;}
getAllHeader(){ loopFile awk -v which="$1" 'NF {print $which}';}
getAll(){ loopFile awk -v which="$1" 'NF {print $which}' | tail -n+2;}
whichWhere(){ loopFile awk -v which="$2" -v where="$(whereVar "$1")" '$where ~ which';}
whereDate(){ whichWhere date;}
whereItem(){ whichWhere item;}
whereCost(){ whichWhere cost;}
# appendYear(){ awk '{print $1"-2022",$2,$3}'
whichGet(){ awk -v which="$1" 'NF {print $which}';}
getDate(){ whichGet "$(whereVar date)";}
getItem(){ whichGet "$(whereVar item)";}
getCost(){ whichGet "$(whereVar cost)";}
getItemNum(){ whichGet "$(whereVar item)" | cut -d'_' -f1;}
getItemNumOnly(){ getItem | cut -d'-' -f1;}
